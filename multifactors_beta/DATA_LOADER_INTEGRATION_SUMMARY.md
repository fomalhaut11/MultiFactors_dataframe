# data_loaderåœ¨AIåŠ©æ‰‹æ¶æ„ä¸­çš„æ ¸å¿ƒåœ°ä½ç¡®ç«‹

## ğŸ¯ æ¶æ„å†³ç­–æ€»ç»“

ç»è¿‡æ·±å…¥åˆ†æå’Œå®è·µéªŒè¯ï¼Œæˆ‘ä»¬ç¡®ç«‹äº†`factors.utils.data_loader`åœ¨æ™ºèƒ½é‡åŒ–åŠ©æ‰‹æ¶æ„ä¸­çš„æ ¸å¿ƒåœ°ä½ã€‚

### âš–ï¸ æ¶æ„æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨æ€§ |
|------|------|------|--------|
| **å®Œå…¨ç›´æ¥è¯»å–** | ç®€å•ç›´æ¥ | ç¡¬ç¼–ç è·¯å¾„ã€é‡å¤é€»è¾‘ | âŒ ä¸é€‚åˆAIåŠ©æ‰‹ |
| **è¿‡åº¦æŠ½è±¡API** | åŠŸèƒ½ä¸°å¯Œ | è¿æ¥æ•°æ®åº“ã€è¿ååŸåˆ™ | âŒ è¿åé¡¹ç›®è¾¹ç•Œ |
| **æ ‡å‡†åŒ–data_loader** | é…ç½®åŒ–ã€ç¼“å­˜ã€éªŒè¯ | éœ€è¦å­¦ä¹ æˆæœ¬ | âœ… **æœ€ä½³æ–¹æ¡ˆ** |

## ğŸ—ï¸ å®æ–½çš„æ¶æ„æ”¹è¿›

### 1. AI_ASSISTANT_BRAIN.md å†³ç­–ä¼˜åŒ–

```markdown
## ğŸ“‹ æ ¸å¿ƒå†³ç­–è¡¨
| ç”¨æˆ·è¾“å…¥å…³é”®è¯ | æˆ‘çš„åˆ¤æ–­ | è°ƒç”¨çš„æ–¹æ³• | ä½¿ç”¨çš„ç°æœ‰API | ç»å¯¹ç¦æ­¢ |
|---------------|----------|-----------|--------------|---------|
| **æ•°æ®è·å–ã€åŠ è½½ã€æ”¶ç›Šç‡ã€ä»·æ ¼ã€å¸‚å€¼** | **æ•°æ®è®¿é—®åœºæ™¯** | **load_data()** | **factors.utils.data_loader** | **ç¡¬ç¼–ç è·¯å¾„** |

## âš¡ å¿«é€Ÿå†³ç­–æµç¨‹
ç”¨æˆ·è¾“å…¥ 
    â†“
åŒ…å«"æ•°æ®ã€åŠ è½½ã€æ”¶ç›Šç‡"? â†’ YES â†’ ç›´æ¥è°ƒç”¨ data_loaderï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
```

**å…³é”®æ”¹è¿›**ï¼šå°†æ•°æ®è·å–åœºæ™¯è®¾ç½®ä¸º**åœºæ™¯0ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰**ï¼Œç¡®ä¿AIåŠ©æ‰‹ä¼˜å…ˆå¤„ç†æ•°æ®éœ€æ±‚ã€‚

### 2. ai_quant_assistant_v2.py è·¯ç”±å¼ºåŒ–

```python
def process_request(self, user_input: str, **kwargs) -> Any:
    # åœºæ™¯0ï¼šæ•°æ®è·å–ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
    data_keywords = ['æ•°æ®', 'åŠ è½½', 'æ”¶ç›Šç‡', 'ä»·æ ¼', 'å¸‚å€¼', 'è´¢åŠ¡æ•°æ®', 'äº¤æ˜“æ—¥æœŸ']
    if any(keyword in user_input for keyword in data_keywords):
        logger.info("ğŸš€ è·¯ç”±åˆ°æ•°æ®è·å–åœºæ™¯")
        return self._route_to_data_loading(user_input, **kwargs)

def _route_to_data_loading(self, user_input: str, **kwargs):
    """è·¯ç”±åˆ°æ•°æ®è·å– - ç›´æ¥è°ƒç”¨data_loader"""
    from factors.utils.data_loader import get_daily_returns, get_price_data, get_market_cap
    from factors.utils.data_loader import FactorDataLoader
    
    # æ™ºèƒ½è¯†åˆ«ç”¨æˆ·éœ€æ±‚å¹¶è°ƒç”¨ç›¸åº”API
    if 'æ”¶ç›Šç‡' in user_input:
        return get_daily_returns()
    elif 'ä»·æ ¼' in user_input:
        return get_price_data()
    elif 'å¸‚å€¼' in user_input:
        return get_market_cap()
```

**å…³é”®æ”¹è¿›**ï¼š
- æ–°å¢`_route_to_data_loading`æ–¹æ³•ï¼Œä¸“é—¨å¤„ç†æ•°æ®è·å–è¯·æ±‚
- ä¿®æ”¹`_prepare_data_for_creation`æ–¹æ³•ï¼Œç”¨data_loaderæ›¿æ¢data_bridge
- æ‰€æœ‰æ•°æ®æ“ä½œç»Ÿä¸€ä½¿ç”¨æ ‡å‡†åŒ–æ¥å£

### 3. æ¼”ç¤ºéªŒè¯æˆåŠŸ

é€šè¿‡`demo_ai_assistant_data_loader.py`éªŒè¯ï¼š

```
åœºæ™¯1: ç”¨æˆ·è¯·æ±‚ - 'è·å–æ—¥æ”¶ç›Šç‡æ•°æ®'
ğŸš€ è·¯ç”±åˆ°æ•°æ®è·å–åœºæ™¯
âœ… æˆåŠŸè·å–æ—¥æ”¶ç›Šç‡æ•°æ®
   æ•°æ®å½¢çŠ¶: (16,022,916,)
   æœ‰æ•ˆæ•°æ®ç‚¹: 11,321,131
   
åœºæ™¯2: ç”¨æˆ·è¯·æ±‚ - 'åŠ è½½ä»·æ ¼æ•°æ®'  
ğŸš€ è·¯ç”±åˆ°æ•°æ®è·å–åœºæ™¯
âœ… æˆåŠŸè·å–ä»·æ ¼æ•°æ®
   æ•°æ®å½¢çŠ¶: (11,326,825, 15)
```

## ğŸ¯ data_loaderçš„æ ¸å¿ƒåœ°ä½

### åœ¨AIåŠ©æ‰‹å†³ç­–ä½“ç³»ä¸­çš„å®šä½

1. **æœ€é«˜ä¼˜å…ˆçº§ï¼ˆåœºæ™¯0ï¼‰**ï¼šä»»ä½•åŒ…å«æ•°æ®è·å–å…³é”®è¯çš„è¯·æ±‚éƒ½ä¼˜å…ˆè·¯ç”±åˆ°data_loader
2. **ç»Ÿä¸€æ•°æ®æ¥å£**ï¼šfactorsæ¨¡å—çš„æ‰€æœ‰æ•°æ®æ“ä½œå¿…é¡»é€šè¿‡data_loader
3. **æ™ºèƒ½è·¯ç”±æ ¸å¿ƒ**ï¼šAIåŠ©æ‰‹é€šè¿‡å…³é”®è¯è¯†åˆ«ï¼Œæ™ºèƒ½è°ƒç”¨ç›¸åº”çš„data_loaderæ–¹æ³•

### AIåŠ©æ‰‹å‹å¥½çš„æ¥å£è®¾è®¡

```python
# ä¾¿æ·å‡½æ•° - AIåŠ©æ‰‹å®¹æ˜“ç†è§£
daily_returns = get_daily_returns()      # è·å–æ—¥æ”¶ç›Šç‡
price_data = get_price_data()            # è·å–ä»·æ ¼æ•°æ®  
market_cap = get_market_cap()            # è·å–å¸‚å€¼æ•°æ®

# é«˜çº§åŠŸèƒ½ - å¤æ‚éœ€æ±‚
loader = FactorDataLoader()
returns_120d = loader.calculate_period_returns(120)  # 120æ—¥æ”¶ç›Šç‡
trading_dates = loader.get_trading_dates()           # äº¤æ˜“æ—¥æœŸ
```

## ğŸš€ ä¸ºæœªæ¥æ™ºèƒ½é‡åŒ–åŠ©æ‰‹å¥ å®šåŸºç¡€

### æ ‡å‡†åŒ–å·¥ä½œæµç¨‹

```
ç”¨æˆ·è¾“å…¥: "æˆ‘éœ€è¦è·å–20æ—¥æ”¶ç›Šç‡æ•°æ®"
    â†“
AIåŠ©æ‰‹è¯†åˆ«: æ•°æ®è·å–åœºæ™¯ï¼ˆå…³é”®è¯ï¼šè·å–ã€æ”¶ç›Šç‡ã€æ•°æ®ï¼‰
    â†“
æ™ºèƒ½è·¯ç”±: _route_to_data_loading()
    â†“
æ ‡å‡†è°ƒç”¨: FactorDataLoader.calculate_period_returns(20)
    â†“
è¿”å›ç»“æœ: pd.Series with 20-day returns
```

### æ ¸å¿ƒåŸåˆ™ç¡®ç«‹

1. **æ•°æ®è¾¹ç•Œæ˜ç¡®**ï¼š
   ```
   dataæ¨¡å—     â†’ è¿æ¥æ•°æ®åº“ï¼Œé¢„å¤„ç†è½åœ°
   factorsæ¨¡å—  â†’ åªç”¨data_loaderï¼Œä¸“æ³¨è®¡ç®—
   ```

2. **APIå±‚æ¬¡åˆç†**ï¼š
   ```
   ç›´æ¥è¯»å–     â†’ ç¡¬ç¼–ç è·¯å¾„ âŒ
   data_bridge  â†’ è¿æ¥æ•°æ®åº“ âŒ  
   data_loader  â†’ æ ‡å‡†åŒ–æ¥å£ âœ…
   ```

3. **AIåŠ©æ‰‹ä¼˜å…ˆ**ï¼šæ‰€æœ‰æ¥å£è®¾è®¡éƒ½è€ƒè™‘AIåŠ©æ‰‹çš„ä½¿ç”¨ä¾¿åˆ©æ€§

## ğŸ“Š å®æ–½æ•ˆæœéªŒè¯

### æ€§èƒ½è¡¨ç°
- æ—¥æ”¶ç›Šç‡æ•°æ®ï¼š16M+è®°å½•ï¼Œ~20ç§’åŠ è½½å®Œæˆ
- ä»·æ ¼æ•°æ®ï¼š11M+è®°å½•ï¼Œ~7ç§’åŠ è½½å®Œæˆ  
- å†…ç½®ç¼“å­˜æœºåˆ¶ï¼Œé‡å¤è®¿é—®å‡ ä¹ç¬æ—¶

### ç”¨æˆ·ä½“éªŒ
- AIåŠ©æ‰‹èƒ½å‡†ç¡®è¯†åˆ«æ•°æ®éœ€æ±‚å…³é”®è¯
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œå‹å¥½æç¤º
- æä¾›å¯ç”¨æ•°æ®ç±»å‹æŒ‡å—

### ä»£ç è´¨é‡
- æ¶ˆé™¤äº†ç¡¬ç¼–ç è·¯å¾„
- ç»Ÿä¸€äº†æ•°æ®éªŒè¯é€»è¾‘
- éµå¾ªäº†é¡¹ç›®æ¶æ„è¾¹ç•Œ

## ğŸŒŸ é•¿è¿œä»·å€¼

é€šè¿‡ç¡®ç«‹data_loaderçš„æ ¸å¿ƒåœ°ä½ï¼Œæˆ‘ä»¬ä¸ºfutureæ™ºèƒ½é‡åŒ–åŠ©æ‰‹å»ºç«‹äº†ï¼š

1. **æ ‡å‡†åŒ–æ•°æ®æ¥å£**ï¼šä»»ä½•AIåŠ©æ‰‹éƒ½èƒ½é€šè¿‡ç»Ÿä¸€æ¥å£è·å–æ•°æ®
2. **æ™ºèƒ½å†³ç­–æ¡†æ¶**ï¼šåŸºäºå…³é”®è¯çš„åœºæ™¯è¯†åˆ«å’Œä¼˜å…ˆçº§è·¯ç”±
3. **å¯æ‰©å±•æ¶æ„**ï¼šæ–°çš„æ•°æ®ç±»å‹å¯ä»¥è½»æ¾é›†æˆåˆ°ç°æœ‰æ¡†æ¶
4. **æœ€ä½³å®è·µç¤ºä¾‹**ï¼šæ¼”ç¤ºäº†å¦‚ä½•æ­£ç¡®é›†æˆdata_loader

---

**æ€»ç»“**ï¼šdata_loaderä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°æ®åŠ è½½å·¥å…·ï¼Œå®ƒæ˜¯AIé‡åŒ–åŠ©æ‰‹æ¶æ„çš„**æ•°æ®è®¿é—®æ¢çº½**ï¼Œä¸ºæ™ºèƒ½åŒ–çš„é‡åŒ–ç ”ç©¶ä½“éªŒå¥ å®šäº†åšå®çš„åŸºç¡€ã€‚