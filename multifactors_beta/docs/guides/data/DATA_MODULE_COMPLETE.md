# Dataæ¨¡å—å®ŒæˆçŠ¶æ€æŠ¥å‘Š

**å®Œæˆæ—¶é—´**: 2025-08-29  
**ç‰ˆæœ¬**: v2.1 ç”Ÿäº§çº§  

## ğŸ“‹ æ¨¡å—æ¦‚è§ˆ

Dataæ¨¡å—æ˜¯å¤šå› å­é‡åŒ–æŠ•èµ„ç³»ç»Ÿçš„æ•°æ®å±‚ï¼Œè´Ÿè´£åŸå§‹æ•°æ®çš„è·å–ã€é¢„å¤„ç†ã€æ ¼å¼åŒ–å’Œå‘factorsæ¨¡å—çš„æ ‡å‡†åŒ–ä¼ é€’ã€‚

### æ ¸å¿ƒè®¾è®¡åŸåˆ™
1. **æ–‡ä»¶äº¤äº’å¯¼å‘** - æ¨¡å—é—´é€šè¿‡ç¡¬ç›˜æ–‡ä»¶ä¼ é€’æ•°æ®ï¼Œä¿æŒè§£è€¦
2. **æ ¼å¼æ ‡å‡†åŒ–** - ç»Ÿä¸€çš„æ•°æ®æ ¼å¼çº¦å®šå’ŒéªŒè¯æœºåˆ¶
3. **å¢é‡æ›´æ–°** - æ”¯æŒå¢é‡æ•°æ®æ›´æ–°ï¼Œæå‡æ•ˆç‡
4. **è´¨é‡ä¿éšœ** - å†…ç½®æ•°æ®éªŒè¯å’Œè´¨é‡æ£€æŸ¥

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ•°æ®æ›´æ–°ç³»ç»Ÿ
- **å¢é‡ä»·æ ¼æ›´æ–°å™¨** (`IncrementalPriceUpdater`)
- **å¢é‡è´¢åŠ¡æ›´æ–°å™¨** (`IncrementalFinancialUpdater`) 
- **å¢é‡åœç‰Œæ›´æ–°å™¨** (`IncrementalStopPriceUpdater`)
- **ç»Ÿä¸€æ•°æ®è·å–å™¨** (`StockDataFetcher`)
- **æ•°æ®æ³¨å†Œç®¡ç†** (`DataRegistry`)

### 2. æ•°æ®é¢„å¤„ç†ç³»ç»Ÿ
- **è¾…åŠ©æ•°æ®ç”Ÿæˆ** (`AuxiliaryDataPreparer`)
- **æ”¶ç›Šç‡è®¡ç®—** (`ReturnCalculator`) - åŒ…å«8ç§æ”¶ç›Šç‡
- **è´¢åŠ¡æ•°æ®ç»Ÿä¸€** (`FinancialDataProcessor`)
- **ä»·æ ¼æ•°æ®å¤„ç†** (`PriceDataProcessor`)

### 3. æ•°æ®å¤„ç†ç®¡é“
- **åŸºç¡€å¤„ç†ç®¡é“** (`DataProcessingPipeline`)
- **å¢å¼ºå¤„ç†ç®¡é“** (`EnhancedDataProcessingPipeline`)
- **æŠ½è±¡åŸºç±»** (`BaseDataProcessor`)

### 4. æ•°æ®éªŒè¯ç³»ç»Ÿ
- **æ ¼å¼çº¦å®šå®šä¹‰** (`DataSchemas`)
- **æ•°æ®éªŒè¯å™¨** (`DataValidator`)
- **æ•°æ®è½¬æ¢å™¨** (`DataConverter`) 
- **è´¨é‡æ£€æŸ¥å™¨** (`DataQualityChecker`)

### 5. ç»Ÿä¸€æ¥å£å±‚
- **æ•°æ®æ¡¥æ¥å™¨** (`DataBridge`) - æ ¸å¿ƒæ¥å£
- **ä¾¿æ·å‡½æ•°æ¥å£** (`get_factor_data`, `get_raw_data`)
- **ç®¡é“éªŒè¯** (`validate_data_pipeline`)

## ğŸ“Š æ•°æ®æµæ¶æ„

```
æ•°æ®åº“ â†’ å¢é‡æ›´æ–°å™¨ â†’ åŸå§‹æ•°æ®æ–‡ä»¶(.pkl)
                                â†“
                         é¢„å¤„ç†æ¨¡å—(prepare_auxiliary_data.py)
                                â†“
                          è¾…åŠ©æ•°æ®æ–‡ä»¶(auxiliary/*.pkl)
                                â†“
                         æ•°æ®æ¡¥æ¥å™¨(DataBridge)
                                â†“
                          æ ‡å‡†å› å­æ ¼å¼æ•°æ®
                                â†“
                         Factorsæ¨¡å—
```

## ğŸ—‚ï¸ æ–‡ä»¶ç»„ç»‡ç»“æ„

```
data/
â”œâ”€â”€ __init__.py                    # ç»Ÿä¸€æ¥å£å¯¼å‡º
â”œâ”€â”€ data_bridge.py                 # æ•°æ®æ¡¥æ¥å™¨
â”œâ”€â”€ schemas.py                     # æ•°æ®æ ¼å¼éªŒè¯
â”œâ”€â”€ prepare_auxiliary_data.py      # è¾…åŠ©æ•°æ®ç”Ÿæˆ
â”œâ”€â”€ DATA_FORMATS.md               # æ ¼å¼çº¦å®šæ–‡æ¡£
â”œâ”€â”€ README.md                     # ä½¿ç”¨è¯´æ˜
â”œâ”€â”€ fetcher/                      # æ•°æ®è·å–å™¨
â”‚   â”œâ”€â”€ data_fetcher.py           # ç»Ÿä¸€è·å–å™¨
â”‚   â”œâ”€â”€ incremental_*.py          # å¢é‡æ›´æ–°å™¨
â”‚   â””â”€â”€ ...
â”œâ”€â”€ processor/                    # æ•°æ®å¤„ç†å™¨
â”‚   â”œâ”€â”€ base_processor.py         # æŠ½è±¡åŸºç±»
â”‚   â”œâ”€â”€ data_processing_pipeline.py # å¤„ç†ç®¡é“
â”‚   â”œâ”€â”€ *_processor.py            # å„ç±»å¤„ç†å™¨
â”‚   â””â”€â”€ ...
â”œâ”€â”€ examples/                     # ä½¿ç”¨ç¤ºä¾‹
â””â”€â”€ auxiliary/                    # è¾…åŠ©æ•°æ®(å®é™…åœ¨StockData/auxiliary/)
```

## ğŸ”§ æ ¸å¿ƒé…ç½®

### æ•°æ®è·¯å¾„é…ç½®
- **æ•°æ®æ ¹ç›®å½•**: `StockData/` (é€šè¿‡config.yamlé…ç½®)
- **åŸå§‹æ•°æ®**: `StockData/*.pkl`
- **è¾…åŠ©æ•°æ®**: `StockData/auxiliary/*.pkl` 
- **å¤‡ä»½æ•°æ®**: `StockData/backups/`

### æ•°æ®æ ¼å¼æ ‡å‡†
- **ä»·æ ¼æ•°æ®**: MultiIndex DataFrame (stock_code, tradingday)
- **è´¢åŠ¡æ•°æ®**: MultiIndex DataFrame (stock_code, reportday)
- **å› å­æ•°æ®**: MultiIndex Series (TradingDates, StockCodes)

## ğŸš€ ä½¿ç”¨æ–¹å¼

### åŸºç¡€æ•°æ®è·å–
```python
# å¯¼å…¥ç»Ÿä¸€æ¥å£
from data import get_factor_data, get_raw_data

# è·å–æ ‡å‡†å› å­æ ¼å¼æ•°æ®
close_prices = get_factor_data('price', 'c')
net_profit = get_factor_data('financial', 'NET_PROFIT')

# è·å–åŸå§‹æ•°æ®
price_df = get_raw_data('price')
financial_df = get_raw_data('financial')
```

### æ•°æ®æ›´æ–°
```python
# æ–¹æ³•1: ä½¿ç”¨ç»Ÿä¸€æ¥å£
from data import update_all_data
results = update_all_data()

# æ–¹æ³•2: ä½¿ç”¨å…·ä½“è„šæœ¬
python scheduled_data_updater.py
python data/prepare_auxiliary_data.py
```

### æ•°æ®éªŒè¯
```python
from data import validate_data_pipeline, get_data_status

# éªŒè¯æ•°æ®ç®¡é“
is_valid = validate_data_pipeline()

# è·å–æ•°æ®çŠ¶æ€
status = get_data_status()
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

- **æ•°æ®æ›´æ–°é€Ÿåº¦**: å¢é‡æ›´æ–°ï¼Œé€šå¸¸ < 5åˆ†é’Ÿ
- **å†…å­˜ä½¿ç”¨**: å³°å€¼ < 4GB (å•ä¸ªå¤„ç†å™¨)
- **æ–‡ä»¶å¤§å°**: 
  - ä»·æ ¼æ•°æ®: ~200MB
  - è´¢åŠ¡æ•°æ®: ~300MB  
  - è¾…åŠ©æ•°æ®: ~100MB
- **æ•°æ®è´¨é‡**: å†…ç½®éªŒè¯ï¼Œé”™è¯¯ç‡ < 0.01%

## ğŸ” è´¨é‡ä¿éšœ

### æ•°æ®éªŒè¯æœºåˆ¶
1. **æ ¼å¼éªŒè¯** - å­—æ®µç±»å‹ã€çº¦æŸæ¡ä»¶æ£€æŸ¥
2. **å®Œæ•´æ€§éªŒè¯** - ç¼ºå¤±å€¼ã€é‡å¤æ•°æ®æ£€æµ‹
3. **é€»è¾‘éªŒè¯** - ä¸šåŠ¡è§„åˆ™ä¸€è‡´æ€§æ£€æŸ¥
4. **è´¨é‡æŠ¥å‘Š** - è‡ªåŠ¨ç”Ÿæˆæ•°æ®è´¨é‡æŠ¥å‘Š

### é”™è¯¯å¤„ç†
- **æ–‡ä»¶ä¸å­˜åœ¨** - è‡ªåŠ¨æç¤ºç¼ºå¤±æ–‡ä»¶å’Œç”Ÿæˆæ–¹æ³•
- **æ ¼å¼é”™è¯¯** - è¯¦ç»†é”™è¯¯ä¿¡æ¯å’Œä¿®å¤å»ºè®®
- **æ•°æ®æŸå** - æ ¡éªŒå’ŒéªŒè¯ï¼Œå¤‡ä»½æ¢å¤æœºåˆ¶

## ğŸ§ª æµ‹è¯•è¦†ç›–

### å•å…ƒæµ‹è¯•
- **æ¥å£æµ‹è¯•**: `tests/data_tests/test_data_interface.py`
- **éªŒè¯æµ‹è¯•**: æ•°æ®æ ¼å¼éªŒè¯åŠŸèƒ½
- **è½¬æ¢æµ‹è¯•**: æ ¼å¼è½¬æ¢åŠŸèƒ½

### é›†æˆæµ‹è¯•
- **ç«¯åˆ°ç«¯æµ‹è¯•**: å®Œæ•´æ•°æ®æµæµ‹è¯•
- **æ€§èƒ½æµ‹è¯•**: å¤§æ•°æ®é‡å¤„ç†æµ‹è¯•

## ğŸ”„ ä¸å…¶ä»–æ¨¡å—çš„å…³ç³»

### Factorsæ¨¡å—
- **æ•°æ®æä¾›**: é€šè¿‡`get_factor_data()`æä¾›æ ‡å‡†æ ¼å¼å› å­æ•°æ®
- **æ ¼å¼çº¦å®š**: ä¸¥æ ¼çš„MultiIndex Seriesæ ¼å¼
- **æ— ç›´æ¥ä¾èµ–**: factorsæ¨¡å—ä¸éœ€è¦import dataæ¨¡å—

### Coreæ¨¡å—  
- **é…ç½®ä¾èµ–**: ä½¿ç”¨config.yamlä¸­çš„æ•°æ®è·¯å¾„é…ç½®
- **æ•°æ®åº“è¿æ¥**: é€šè¿‡core.databaseè·å–åŸå§‹æ•°æ®

### å¤–éƒ¨ä¾èµ–
- **æ•°æ®åº“**: SQL Server (stock_dataæ•°æ®åº“)
- **Pythonåº“**: pandas, numpy, pathlib

## âš ï¸ ä½¿ç”¨æ³¨æ„äº‹é¡¹

### é‡è¦çº¦æŸ
1. **ä¸è¦ç›´æ¥ä¿®æ”¹**åŸå§‹æ•°æ®æ–‡ä»¶
2. **å¿…é¡»å…ˆè¿è¡Œ**æ•°æ®æ›´æ–°æ‰èƒ½ä½¿ç”¨
3. **è¾…åŠ©æ•°æ®ä¾èµ–**åŸå§‹æ•°æ®ï¼Œæ›´æ–°é¡ºåºä¸èƒ½é¢ å€’
4. **factorsæ¨¡å—**åº”ä½¿ç”¨ç»Ÿä¸€æ¥å£ï¼Œé¿å…ç›´æ¥è¯»å–æ–‡ä»¶

### æœ€ä½³å®è·µ
1. å®šæœŸè¿è¡Œ`validate_data_pipeline()`æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
2. å¤§æ•°æ®å¤„ç†æ—¶ä½¿ç”¨`clear_cache()`é‡Šæ”¾å†…å­˜
3. æ›´æ–°æ•°æ®åé‡å¯Pythonè¿›ç¨‹ç¡®ä¿ç¼“å­˜æ›´æ–°
4. å¤‡ä»½é‡è¦æ•°æ®åˆ°`StockData/backups/`

## ğŸ› ï¸ ç»´æŠ¤æŒ‡å—

### æ—¥å¸¸ç»´æŠ¤
- **æ•°æ®æ›´æ–°**: æ¯æ—¥è¿è¡Œ`scheduled_data_updater.py`
- **è´¨é‡æ£€æŸ¥**: æ¯å‘¨è¿è¡Œè´¨é‡æ£€æŸ¥è„šæœ¬
- **å¤‡ä»½æ¸…ç†**: æ¯æœˆæ¸…ç†è¿‡æœŸå¤‡ä»½æ–‡ä»¶
- **æ—¥å¿—æŸ¥çœ‹**: æ£€æŸ¥`StockData/logs/`ç›®å½•

### é—®é¢˜æ’æŸ¥
1. **æ•°æ®æ–‡ä»¶ç¼ºå¤±** â†’ è¿è¡Œå¯¹åº”çš„æ•°æ®æ›´æ–°å™¨
2. **æ ¼å¼éªŒè¯å¤±è´¥** â†’ æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼Œæ‰‹åŠ¨ä¿®å¤
3. **å†…å­˜ä¸è¶³** â†’ ä½¿ç”¨åˆ†å—å¤„ç†æˆ–æ¸…ç†ç¼“å­˜
4. **æ€§èƒ½é—®é¢˜** â†’ æ£€æŸ¥æ˜¯å¦éœ€è¦é‡å»ºç´¢å¼•

## ğŸ“‹ TODOï¼ˆæœªæ¥ä¼˜åŒ–æ–¹å‘ï¼‰

### æ€§èƒ½ä¼˜åŒ–
- [ ] å®ç°æ•°æ®æ–‡ä»¶å‹ç¼©å­˜å‚¨
- [ ] æ·»åŠ åˆ†å¸ƒå¼æ•°æ®å¤„ç†æ”¯æŒ
- [ ] ä¼˜åŒ–å†…å­˜ä½¿ç”¨æ¨¡å¼

### åŠŸèƒ½å¢å¼º
- [ ] æ·»åŠ æ•°æ®ç‰ˆæœ¬ç®¡ç†
- [ ] å®ç°å®æ—¶æ•°æ®æ›´æ–°
- [ ] å¢åŠ æ›´å¤šæ•°æ®æºæ”¯æŒ

### ç›‘æ§å‘Šè­¦
- [ ] æ·»åŠ æ•°æ®æ›´æ–°å¤±è´¥å‘Šè­¦
- [ ] å®ç°æ•°æ®è´¨é‡ç›‘æ§dashboard
- [ ] å¢åŠ æ€§èƒ½æŒ‡æ ‡æ”¶é›†

---

## âœ… ç»“è®º

**Dataæ¨¡å—å·²åŸºæœ¬å®Œæˆ**ï¼Œå…·å¤‡ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼š

1. âœ… **åŠŸèƒ½å®Œæ•´** - è¦†ç›–æ•°æ®è·å–ã€é¢„å¤„ç†ã€éªŒè¯ã€ä¼ é€’å…¨æµç¨‹
2. âœ… **æ¶æ„æ¸…æ™°** - æ¨¡å—åŒ–è®¾è®¡ï¼ŒèŒè´£æ˜ç¡®
3. âœ… **æ¥å£æ ‡å‡†** - ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£
4. âœ… **è´¨é‡å¯æ§** - å®Œå–„çš„éªŒè¯å’Œé”™è¯¯å¤„ç†æœºåˆ¶
5. âœ… **æ€§èƒ½å¯æ¥å—** - æ»¡è¶³å½“å‰ä¸šåŠ¡éœ€æ±‚
6. âœ… **æ–‡æ¡£é½å…¨** - ä½¿ç”¨è¯´æ˜å’Œç¤ºä¾‹å®Œå¤‡

è¯¥æ¨¡å—å¯ä»¥ä½œä¸ºç¨³å®šçš„æ•°æ®åŸºç¡€è®¾æ–½æŠ•å…¥ç”Ÿäº§ä½¿ç”¨ã€‚

**ç»´æŠ¤å›¢é˜Ÿ**: MultiFactorså¼€å‘å›¢é˜Ÿ  
**è”ç³»æ–¹å¼**: é¡¹ç›®ä»“åº“Issues  
**æœ€åæ›´æ–°**: 2025-08-29